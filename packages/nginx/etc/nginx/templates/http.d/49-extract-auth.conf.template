set $authUserId 0;
set $authUserToken 0;

# extract $authUserId and $authUserToken from $http_authorization header.
if ( $http_authorization ~ ^Alwatr\s+([A-z0-9_=-]+):([A-z0-9_=-]+)$ ) {
  set $authUserId $1;
  set $authUserToken $2;
}

# extract $userLocation from first 3 characters of `$authUserId`.
map $userLocation $authUserId {
  default 0;
  # Micro optimization: if `$authUserId` is zero, don't bother with regex.
  0 0;
  "~^(?<prefix>.{3})" $storeRegionPerUser/$prefix/$authUserId;
}
